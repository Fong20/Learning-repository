# 03 Transport Layer
- Transport layer provides logical communication between processes running on different hosts

Role of hosts in transport layer:
- Sender host: Peforms segmentation of packets (process of breaking down a large packet into smaller segments / datagrams)
- Destination host: Reassembles segments into the message, and pass to application layer

**Types of protocol in the transport layer**
1. Transmission Control Protocol (TCP)
2. User Datagram Protocol (UDP)

## TCP vs UDP
- TCP is reliable whereas UDP is not reliable (best effort)
- TCP is connection oriented (establish connection between the host and destination through 3 way handshake. The 3 way handshake ensures that the destination is reachable) while UDP is connectionless
- TCP provides both congestion control and flow control while UDP does not provide any of the control
- TCP is stateful (Host maintains buffer utilization for flow control, congestion control parameter for congestion control and acknowledgment number for reliability) while UDP is stateless (Host do not maintain buffer utilization, congestion
control parameter, acknowledgment number)
- Since TCP is reliable and provides various functions such as congestion control and flow control, it's header size is larger than the UDP's header size
- TCP is slower than UDP as TCP needs to establish a connection between the sender and receiver which incurs delay.
- TCP is used in services which require data integrity and reliability such as email, file trnasfer services etc while UDP is used for services such as Voice over IP (VoIP), livestreaming services etc which require faster performance. 
  
![image](https://github.com/user-attachments/assets/75334195-59ec-4f70-89d5-fa17e156099b)

## TCP Congestion control
- Congestion control controls a host's sending rate so that each connection which travels through the link utilize an equal share of bandwidth
- It does so by using the comparing between receive window value (rwnd) and congestion window value (cwnd) and selecting the minimum value. After comparing and selecting the minimum value, the sender will send packets of size less than the minimum value of rwnd / cwnd bytes to the receiver.
- cwnd value = 1 MSS

Receiver knows that a network is congested through two parameters:
1. packet loss
2. End to end delay = RTT / 2

There are two main components of congestion control
1. Slow start
2. Congestion avoidance

### TCP Congestion control: Slow start
When connection begins, it starts by sending 1 segment and slowly increase the amount of segments sent exponentially until the first packet loss occurs or the cwnd value is reached.

### TCP Congestion control: Congestion avoidance
When packet loss occurs, the cwnd / 2

### TCP Congestion control: Packet loss
Deals with packet loss which could occur due to timeout or triple duplicate ACK

TCP Tahoe (conservative approach)

TCP Reno (aggressive approach)
- Set cwnd value

TCP Tahoe vs TCP Reno
- TCP Reno provides more throughput compared to TCP Tahoe as TCP Tahoe sets cwnd to 1 when it faces timeout or triple duplicate ACK while TCP Reno only sets the cwnd to 1 when it faces timeout.
  
![image](https://github.com/user-attachments/assets/b94fff52-a593-4d9b-824e-17dfcfd9bbcf)


## TCP Flow control
- Flow control controls the source host's sending rate so that it does not overflow the receiver host's buffer (capacity)
- It does so by informing the sender the receiver's window value (rwnd value). As a result, the sender will send packets with a size less than rwnd bytes to the receiver.
- rwnd indicates the free buffer space avaiable at the receiver in the unit of bytes. The rnd value can be changed according to the status of the network.
- buffered data = data which is already stored in the memory

## Reliable data transfer protocol in TCP
The reliability of data transfer through TCP can be described through 4 scenarios:
1. No packet loss
2. Packet loss
3. ACK loss
4. Timeout / Delayed ACK

### Scenario 1: No packet loss
In this scenario, the packet is sent to the receiver. When the receiver received the packet, it will send back an acknowledgement to the sender. Once the acknowledgement is received by the sender, the sender will send the next packet.

![image](https://github.com/user-attachments/assets/f2e6116b-840d-4790-b195-153da9a027cf)


### Scenario 2: Packet loss
- In packet loss, the sender sends a packet to the receiver but the packet did not reach the receiver. As a result, there is no Acknowledgement received.
- Once the sender does not receive the acknowledgement within the timeframe (timeout), it will resend the lost packet tothe receiver.
  
![image](https://github.com/user-attachments/assets/f81d315d-ae87-4fa9-a94e-194490e15f08)

### Scenario 3: ACK loss
- ACK loss scenario is similar to packet loss scenario where the sender fails to receive an acknowledgement from the receiver within a specfic time (timeout). In this case, the only difference is that the packet is received by the receiver but the acknowledgement is lost on route to the sender.
- As a result, the packet will be resent by the sender to the receiver which would cause the receiver to receive duplicate packets.

### Scenario 4: Delayed ACK
In this scanario, the ackowledgement is recieved by the sender with a delay, causing the time to expire. As a result, the packet is resent by the sender to the receiver which causes duplicate.

![image](https://github.com/user-attachments/assets/9fa6a94c-60ce-45eb-85d0-721d2c4c78c1)

### Stop and wait protocol
- In a stop and wait protocol, the sender sends a single packet and waits until it receives acknowledgment; then only send the next packet. As a result, it takes more time as the sender is not performing anything when waiting for the acknowledgement.
- Stop and wait protocol has a lower utilization

Example: 

Utilization formula (Usender) = NL/R / (RTT + L/R), where N is the number of packets

![image](https://github.com/user-attachments/assets/d80bb932-cfde-47d4-804d-0b9597755dda)


### Pipelined protocol
- In pipelined protocol, the sender sends multiple unacknowledged packets at a single time
- As a result, the sender must increase the range of sequence number and the receiver must have sufficient buffer size to receive multiple packets at the same time

Example:

![image](https://github.com/user-attachments/assets/d7de0a21-4ec6-4bb3-9e0c-17dd143c3eed)

There are two types of pipelined protocol:
1. Go Back N (GBN)
2. Selective Repeat (SR)

### Go-back-N
- Sender: Able to send N unacknowledged packets. 
- Receiver: Go-back-n only sends cumulative acknowledgement which is the acknowledgement of packet N that indicates all packets with the sequence number up to and including N have been received in correct order Eg: Send 20 packets, the cumulative acknowledgement which will be sent by the receiver is 20
- No buffer (Does not have a temporary storage to store the out of order delivery packets. As a result, the packet cannot be arranged in sequence and needs to be dropped. The sender needs to resent the required packet, reducing the bandwidth utilization as the bandwidth needs to be utilized to retransmit the same packet.)
- Timeout: Sender has a single timer for the oldest unacknowledged packet (window size). When timer expire, retransmit all sent but unacknowledged packets. If window size is large, There can be many unacknowledged packets in pipeline, so a single packet loss can cause sender to retransmit many packets. Eg: Sender sends 20 packets to the receiver and the receiver received all 19 packets successfully except for but the 20th packet. Thus, the all the 20 packets need to be retransmitted.

Window size
- Refers to the number of packets which can be received by the receiver
- Window size = N
- The window size cannot be too high and too low. Too low = poor utilization of bandwidth, too high = overwhelm the receiver, increasing packet loss.
- When sender receive an acknowledgment, it slide forward window so that a sequence number change from not usable to usable, not yet sent
- We must make sure that the window
We cannot increase the value of N as it overwhelms the receiver and causes network congestion, affecting the network's performance

### Selective repeat
- Sender: Able to send N unacknowledged packets in pipeline
- Receiver: An acknowledgment is sent by the receiver to the sender for each packet
- Has buffer.
- Timeout: Sender has a timer for each unacknowledged packet, so it has many timers. When timer expire, it retransmits the unacknowledged packet only. As a result, it addresses the disadvantage of Go back N protocol.

### Go back-N vs Selective repeat pipelined protocols
- Sender: There is no differece between go-back-n and selective receiver in terms of the sender as both protocols allow senders to send multiple unacknowledged packets
- Receiver: The receiver sends cumulative acknowledgment in  Go-back N while the receiver sends individual acknowledgement for each packet in selective repeat
- Go-back N is faster than selective repeat as the sender does not need to wait for an acknowledgement for each packet



